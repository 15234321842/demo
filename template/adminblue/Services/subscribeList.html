{extend name="adminblue/base" /}
{block name="resources"/}
<link rel="stylesheet" type="text/css" href="ADMIN_CSS/product.css">
<script type="text/javascript" src="__STATIC__/My97DatePicker/WdatePicker.js"></script>
<style type="text/css">
#productTbody td{border: 0;padding:5px;}
.tr-title td{background: #e4f2ff !important;}
.table-title th{padding: 10px;border-bottom: 1px solid #e5e5e5;font-weight: normal;background: #F3F1F1 !important;}
.a-pro-view-img {float: left;}
.thumbnail-img {width: 60px;margin-right: 10px;}
.cell i {display: block;}
.remodal-bg.with-red-theme.remodal-is-opening,.remodal-bg.with-red-theme.remodal-is-opened {filter: none;}
.remodal-overlay.with-red-theme {background-color: #f44336;}
.remodal.with-red-theme {background: #fff;}
input[type="radio"], input[type="checkbox"] {margin: -1px 5px 0 0;}
.edit-group{border-bottom: 1px solid #ebebeb;margin-bottom:10px;}
.edit-group label{font-weight:normal;}
.edit-group-title{height:15px;line-height:15px;width:140px;margin-top:3px;margin-bottom:3px;color:#ff6f44;}
.edit-group-button{border-color: #ff6f44;border: 1px solid #bbb;height: 26px;line-height: 24px;padding: 0 5px;}
.group-button-bg{background: #ff6f44;color: #fff;}
.div-pro-view-name {width: 100%;min-height: 60px;}
i.hot,i.recommend,i.new{font-size:12px;margin-right:5px;font-style:normal;color:#fff;background-color:#E84C3D;border-radius:2px;padding:1px 2px;position: relative;top:-5px;}
.icon-qrcode:before {content: "\f029";}
[class^="icon-"]:before, [class*=" icon-"]:before {text-decoration: inherit;display: inline-block;speak: none;}
[class^="icon-"], [class*=" icon-"] {font-family: FontAwesome;font-weight: normal;font-style: normal;text-decoration: inherit;-webkit-font-smoothing: antialiased;}
.goodsCategory{width: 159px;height: 300px;border: 1px solid #CCCCCC;position: absolute;z-index: 100;background: #fff;right: 0;display: none;overflow-y: auto;top: 31px;}
.goodsCategory::-webkit-scrollbar{width: 3px;}
.goodsCategory::-webkit-scrollbar-track{-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);border-radius: 10px;background-color: #fff;}
.goodsCategory::-webkit-scrollbar-thumb{height: 20px;border-radius: 10px;-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);background-color: #ccc;}
.goodsCategory ul{height: 280px;margin-top: -2px;margin-left: 0;}
.goodsCategory ul li{text-align: left;padding:0 10px;line-height: 30px;}
.goodsCategory ul li i{float: right;line-height: 30px;}
.goodsCategory ul li:hover{cursor: pointer;}
.goodsCategory ul li:hover,.goodsCategory ul li.selected{background: #1C8FEF;color: #fff;}
.goodsCategory ul li span{width: 120px;display: inline-block;white-space: nowrap;text-overflow: ellipsis;overflow: hidden;vertical-align: middle;font-size:12px;}
.two{left: 160px;border-left:0;}
.three{left: 320px;width: 159px;border-left:0;}
.selectGoodsCategory{width: 218px;height: 45px;border:1px solid #CCCCCC;position: absolute;z-index: 100;left: 0;margin-top: 299px;border-collapse: collapse;background: #fff;display: none;}
.selectGoodsCategory a{display: block;height: 30px;width: 100px;text-align: center;color: #fff;line-height: 30px;margin:8px;background: #ff6f44;text-decoration:none;}
input[type=number] {-moz-appearance:textfield;}
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {-webkit-appearance: none;margin: 0;}
input, textarea, .uneditable-input {width: 147px;}
.table th{font-weight: normal;}
.table th, .table td {vertical-align: middle;}
.recommendBox{width: 360px;display: inline-block;float: right;}
.introduction_box{width: 360px;display: inline-block;float: right;}
.tab-content{overflow: visible;}
.editGoodsIntroduction{display: inline-block;border:1px dashed #fff;padding: 0 5px;width: 350px;line-height: 25px;max-height: 60px;overflow: hidden;text-overflow: ellipsis;height: 25px;}
.editGoodsIntroduction:hover{border-color: #ddd;cursor: pointer;}
.editGoodsIntroduction + input{display: inline-block;border:1px solid #00C0FF;padding: 0 5px;width: 350px;line-height: 25px;height: 25px;background: #EEF7FF;display: none;border-radius: 0;}
.padding_none{height: auto;}
.goods-fields-sort{cursor:pointer;}
.goods-fields-sort span{background: url('ADMIN_IMG/goods_sort.png') no-repeat;width:20px;height:20px;display: inline-block;margin-left:5px;vertical-align: middle;position: absolute;}
.goods-fields-sort span.asc{background-position: 0 5px;}
.goods-fields-sort span.selected.asc{background-position: -30px 5px;}
.goods-fields-sort span.desc{background-position: 0 -24px;}
.goods-fields-sort span.selected.desc{background-position: -30px -24px;}
</style>
{/block}
{block name="main"}
<div class="js-mask-category" style="display:none;background: rgba(0,0,0,0);position:fixed;width:100%;height:100%;top:0;left:0;right:0;bottom:0;z-index:90;"></div>

<table class="mytable">
	<tr>
		<th style="text-align: left;">
			<button class="btn-common btn-small" onclick="return changeStyle(1);" style="margin:0 !important;">预约来访</button>
			<button class="btn-common btn-small" onclick="return changeStyle(2)" style="margin:0 !important;">预约祭祀</button>
			<button class="btn-common btn-small" onclick="return changeStyle(3)" style="margin:0 !important;">预约登位</button>
			<input type="hidden" id="style" value="1">
		</th>
		<th style="line-height:33px;position: relative;">
			用户名：<input id="username" class="input-medium input-common" type="text" value="" placeholder="请输入用户名" >
			联系方式：<input id="mobile" class="input-medium input-common" type="text" value="" placeholder="请输入联系方式" >
			预约时间：
				<input type="text" id="startDate" class="input-common w100" placeholder="请选择开始日期" onclick="WdatePicker()" />
				&nbsp;-&nbsp;
				<input type="text" id="endDate" placeholder="请选择结束日期" class="input-common w100" onclick="WdatePicker()" />
			<input type="button" onclick="searchData()" value="搜索" class="btn-common"/>
			</div>
		</th>
	</tr>
</table>
<div id="myTabContent" class="tab-content">
	<div class="tab-pane active">
		<table class="table table-striped table-main" border="0">
			<tbody>
				<tr class="table-title title1">
					<th >用户名</th>
					<th style="text-align: center;">来访者姓名</th>
					<th data-field="price" style="text-align: center;">联系电话<span class="desc"></span></th>
					<th class="goods-fields-sort" data-field="time" style="text-align: center;">来访时间<span class="desc"></span></th>
					<th data-field="sales" style="text-align: center;">来访事项<span class="desc"></span></th>
					<th class="goods-fields-sort" data-field="status" style="text-align: center;">预约状态<span class="desc"></span></th>
					<th style="text-align:center;">操作</th>
				</tr>
				<tr class="table-title title2" style="display: none">
					<th >用户名</th>
					<th data-field="price" style="text-align: center;">联系电话<span class="desc"></span></th>
					<th class="goods-fields-sort" data-field="time" style="text-align: center;">来园时间<span class="desc"></span></th>
					<th data-field="sales" style="text-align: center;">来园人数<span class="desc"></span></th>
					<th style="text-align: left;">备注</th>
					<th style="text-align: center;">福位编号</th>
					<th class="goods-fields-sort" data-field="status" style="text-align: center;">预约状态<span class="desc"></span></th>
					<th style="text-align:center;">操作</th>
				</tr>
				<tr class="table-title title3" style="display: none">
					<th >用户名</th>
					<th style="text-align: center;">购买者姓名</th>
					<th data-field="price" style="text-align: center;">联系电话<span class="desc"></span></th>
					<th class="goods-fields-sort" data-field="time" style="text-align: center;">计划登位日期时间<span class="desc"></span></th>
					<th data-field="sales" style="text-align: center;">使用人姓名<span class="desc"></span></th>
					<th style="text-align: center;">出生日期</th>
					<th style="text-align: center;">去世日期</th>
					<th style="text-align: center;">福位编号</th>
					<th class="goods-fields-sort" data-field="status" style="text-align: center;">预约状态<span class="desc"></span></th>
					<th style="text-align:center;">操作</th>
				</tr>
			</tbody>
			<tbody id="productTbody" style="border: 0px;"></tbody>
		</table>
	</div>
	<input type="hidden" id="selectGoodsLabelId">
	<input type="hidden" id="stock_warning" value="{$stock_warning}">
</div>
<input type="hidden" id="hidden_sort_rule" />
{/block}
{block name="script"}
<script type="text/javascript">
	function changeStyle(val) {
		$("#style").val(val);
		if(val==1){
			$(".title1").show();
			$(".title2").hide();
			$(".title3").hide();
		}else if(val==2){
            $(".title1").hide();
            $(".title2").show();
            $(".title3").hide();
		}else{
            $(".title1").hide();
            $(".title2").hide();
            $(".title3").show();
		}
        LoadingInfo(1);
    }
$(function(){
	$(".js-update-goods-name,.js-update-introduction").live("blur",function(){
		var up_type = $(this).attr("data-up-type");
		var goods_id = $(this).attr("data-goods-id");
		var editContent = $(this).val();
		if(editContent == ""){
			if(up_type == "goods_name"){
				showTip("服务名不可为空","warning");
				$(this).focus();
				return false;
			}
		}
		var $self = $(this);
		$.ajax({
			type : "post",
			url : "{:__URL('ADMIN_MAIN/services/ajaxEditGoodsNameOrIntroduction')}",
			data : {
				"goods_id" : goods_id,
				"up_type" : up_type,
				"up_content" : editContent
			},
			success : function(data){
				if(data['code'] > 0){
					$self.prev(".editGoodsIntroduction").children("a").text(editContent);
				}
				$self.hide();
				$self.prev(".editGoodsIntroduction").show();
			}
		});
	}).live("keyup",function(event){
		if(event.keyCode == 13) $(this).blur();
	});
	
	//排序规则
	$(".goods-fields-sort").click(function(){
		
		var field = $(this).attr("data-field");
		var sort_rule = $(this).attr("data-field");
		$(this).siblings().css("color","#333333").find("span").removeClass("desc selected").addClass("desc");
		$(this).css("color","#ff6f44");
		if($(this).find("span").hasClass("desc") && $(this).find("span").hasClass("selected")){
			$(this).find("span").removeClass("desc").addClass("selected asc");
			sort_rule += ",a";
		}else if(($(this).find("span").hasClass("asc") && $(this).find("span").hasClass("selected")) || $(this).find("span").hasClass("desc")){
			$(this).find("span").removeClass("asc").addClass("selected desc");
			sort_rule += ",d";
		}
		$("#hidden_sort_rule").val(sort_rule);
		LoadingInfo(1);
	});

});

function searchData(){
	LoadingInfo(1);
}

//隐藏服务分组
function hideEditGroup(){
	$("#editGroup").popover("hide");
}

function hideSetRecommend(){
	$("#setRecommend").popover("hide");
}

function LoadingInfo(page_index) {
	var style = $("#style").val();
	console.log(style);
	var start_date = $("#startDate").val();
	var end_date = $("#endDate").val();
	var username = $("#username").val();
	var mobile = $("#mobile").val();
	// var state = $("#state").val();
	// var goods_name =$("#goods_name").val();
	// var goods_code = $("#goods_code").val();
	// var category_id_1 = $("#category_id_1").val();
	// var category_id_2 = $("#category_id_2").val();
	// var category_id_3 = $("#category_id_3").val();
	// var selectGoodsLabelId = $("#selectGoodsLabelId").val();
	// var supplier_id = $("#supplier_id").val();
	// var stock_warning = $("#stock_warning").val();
	$.ajax({
		type : "post",
		url : "{:__URL('ADMIN_MAIN/services/subscribeList')}",
		data : {
			"style" : style,
			"page_index" : page_index,
			"page_size" : $("#showNumber").val(),
			"start_date":start_date,
			"end_date":end_date,
			"username":username,
			"mobile":mobile,
			// "state":state,
			// "goods_name":goods_name,
			// "code":goods_code,
			// "category_id_1" : category_id_1,
			// "category_id_2" : category_id_2,
			// "category_id_3" : category_id_3,
			// "selectGoodsLabelId" : selectGoodsLabelId,
			// "supplier_id" : supplier_id,
			// "stock_warning" : stock_warning,
			'sort_rule' : $("#hidden_sort_rule").val()
		},
		success : function(data) {

			var html = '';

			if (data["data"].length > 0) {
			    if(style==1) {
                    for (var i = 0; i < data["data"].length; i++) {

                        html += '<tr class="tr-title">';
                        html += '<td colspan="7">';
                        html += '<div style="display: inline-block; width: 100%;font-size:12px;" class="pro-code">';
                        html += '<span class="pro-code" style="margin-left:10px;">创建时间：' + timeStampTurnTime(data["data"][i]["create_time"]);
                        html += '<span class="div-flag-style" style="display: inline-block;margin:0 20px 0 40px;position:relative">';
                        html += '</span>';
                        html += '</span>';
                        html += '</div>';
                        html += '</td>';
                        html += '</tr>';

                        html += '<tr>';
                        html += '<td>';
                        html += '<span style="color: #13A5D5;" class="thumbnail-name title=' + data["data"][i]["goods_name"] + '">';
                        html += '' + data["data"][i]["user_name"] + '';
                        html += '</span>';
                        html += '</td>';

                        html += '<td style="text-align:center;">';
                        html += '<div>';
                        html += '<span class="price-numble"id="moreChangePrice' + data["data"][i]["goods_id"] + '" style="color:red;">' + data["data"][i]["name"] + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + data["data"][i]["mobile"] + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + timeStampTurnTime(data["data"][i]["time"]) + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">' + data["data"][i]["content"] + '</td>';
                        if (data["data"][i]["status"] == 0) {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-info">' + status(data["data"][i]["status"]) + '</span></td>';
                        } else if (data["data"][i]["status"] == 1) {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-success">' + status(data["data"][i]["status"]) + '</span></td>';
                        } else {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-danger">' + status(data["data"][i]["status"]) + '</span></td>';
                        }

                        html += '<td>';
                        html += '<div class="bs-docs-example tooltip-demo"style="text-align: center;">';
                        // html += '<a href="' + __URL("ADMIN_MAIN/services/addgoods?step=2&goodsId="+ data["data"][i]["goods_id"]) + '" title="编辑服务" style="padding-right:10px;">编辑</a>';
                        if (data["data"][i]["status"] == 0) {
                            html += '<a class="pass' + data["data"][i]["id"] + '" href="javascript:pass(1,' + data["data"][i]["id"] + ')" style="padding-right:10px;">通过</a>';
                            html += '<a class="pass' + data["data"][i]["id"] + '" href="javascript:pass(2,' + data["data"][i]["id"] + ')" style="padding-right:10px;">不通过</a>';
                        }
                        html += '<a href="javascript:deleteGoods(' + data["data"][i]["id"] + ')" title="删除">删除</a>';
                        html += '</div>';
                        html += '</td>';
                        html += '</tr>';
                    }
                }else if(style==2){
                    for (var i = 0; i < data["data"].length; i++) {
                        html += '<tr class="tr-title">';
                        html += '<td colspan="8">';
                        html += '<div style="display: inline-block; width: 100%;font-size:12px;" class="pro-code">';
                        html += '<span class="pro-code" style="margin-left:10px;">创建时间：' + timeStampTurnTime(data["data"][i]["create_time"]);
                        html += '<span class="div-flag-style" style="display: inline-block;margin:0 20px 0 40px;position:relative">';
                        html += '</span>';
                        html += '</span>';
                        html += '</div>';
                        html += '</td>';
                        html += '</tr>';

                        html += '<tr>';
                        html += '<td>';
                        html += '<span style="color: #13A5D5;" class="thumbnail-name title=' + data["data"][i]["goods_name"] + '">';
                        html += '' + data["data"][i]["user_name"] + '';
                        html += '</span>';
                        html += '</td>';

                        html += '<td style="text-align:center;">';
                        html += '<div>';
                        html += '<span class="price-numble"id="moreChangePrice' + data["data"][i]["goods_id"] + '" style="color:red;">' + data["data"][i]["mobile"] + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + timeStampTurnTime(data["data"][i]["time"]) + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + data["data"][i]["peoples"] + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">' + data["data"][i]["positions_no"] + '</td>';
                        html += '<td style="text-align: center;">' + data["data"][i]["remark"] + '</td>';
                        if (data["data"][i]["status"] == 0) {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-info">' + status(data["data"][i]["status"]) + '</span></td>';
                        } else if (data["data"][i]["status"] == 1) {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-success">' + status(data["data"][i]["status"]) + '</span></td>';
                        } else {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-danger">' + status(data["data"][i]["status"]) + '</span></td>';
                        }

                        html += '<td>';
                        html += '<div class="bs-docs-example tooltip-demo"style="text-align: center;">';
                        // html += '<a href="' + __URL("ADMIN_MAIN/services/addgoods?step=2&goodsId="+ data["data"][i]["goods_id"]) + '" title="编辑服务" style="padding-right:10px;">编辑</a>';
                        if (data["data"][i]["status"] == 0) {
                            html += '<a class="pass' + data["data"][i]["id"] + '" href="javascript:pass(1,' + data["data"][i]["id"] + ')" style="padding-right:10px;">通过</a>';
                            html += '<a class="pass' + data["data"][i]["id"] + '" href="javascript:pass(2,' + data["data"][i]["id"] + ')" style="padding-right:10px;">不通过</a>';
                        }
                        html += '<a href="javascript:deleteGoods(' + data["data"][i]["id"] + ')" title="删除">删除</a>';
                        html += '</div>';
                        html += '</td>';
                        html += '</tr>';
                    }
				}else if(style==3){
                    for (var i = 0; i < data["data"].length; i++) {
                        html += '<tr class="tr-title">';
                        html += '<td colspan="10">';
                        html += '<div style="display: inline-block; width: 100%;font-size:12px;" class="pro-code">';
                        html += '<span class="pro-code" style="margin-left:10px;">创建时间：' + timeStampTurnTime(data["data"][i]["create_time"]);
                        html += '<span class="div-flag-style" style="display: inline-block;margin:0 20px 0 40px;position:relative">';
                        html += '</span>';
                        html += '</span>';
                        html += '</div>';
                        html += '</td>';
                        html += '</tr>';

                        html += '<tr>';
                        html += '<td>';
                        html += '<span style="color: #13A5D5;" class="thumbnail-name title=' + data["data"][i]["goods_name"] + '">';
                        html += '' + data["data"][i]["user_name"] + '';
                        html += '</span>';
                        html += '</td>';

                        html += '<td style="text-align:center;">';
                        html += '<div>';
                        html += '<span class="price-numble"id="moreChangePrice' + data["data"][i]["goods_id"] + '" style="color:red;">' + data["data"][i]["buyer_name"] + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + data["data"][i]["mobile"] + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + timeStampTurnTime(data["data"][i]["time"]) + '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: center;">' + data["data"][i]["username"] + '</td>';
                        html += '<td style="text-align: center;">' + timeStampTurnTime(data["data"][i]["birthday"]) + '</td>';
                        html += '<td style="text-align: center;">' + timeStampTurnTime(data["data"][i]["dieday"]) + '</td>';
                        html += '<td style="text-align: center;">' + data["data"][i]["positions_no"] + '</td>';
                        if (data["data"][i]["status"] == 0) {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-info">' + status(data["data"][i]["status"]) + '</span></td>';
                        } else if (data["data"][i]["status"] == 1) {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-success">' + status(data["data"][i]["status"]) + '</span></td>';
                        } else {
                            html += '<td style="text-align: center;"><span class="status'+data["data"][i]['id']+' label label-danger">' + status(data["data"][i]["status"]) + '</span></td>';
                        }

                        html += '<td>';
                        html += '<div class="bs-docs-example tooltip-demo"style="text-align: center;">';
                        // html += '<a href="' + __URL("ADMIN_MAIN/services/addgoods?step=2&goodsId="+ data["data"][i]["goods_id"]) + '" title="编辑服务" style="padding-right:10px;">编辑</a>';
                        if (data["data"][i]["status"] == 0) {
                            html += '<a class="pass' + data["data"][i]["id"] + '" href="javascript:pass(1,' + data["data"][i]["id"] + ')" style="padding-right:10px;">通过</a>';
                            html += '<a class="pass' + data["data"][i]["id"] + '" href="javascript:pass(2,' + data["data"][i]["id"] + ')" style="padding-right:10px;">不通过</a>';
                        }
                        html += '<a href="javascript:deleteGoods(' + data["data"][i]["id"] + ')" title="删除">删除</a>';
                        html += '</div>';
                        html += '</td>';
                        html += '</tr>';
                    }
                }

			} else {
				html += '<tr align="center"><td colspan="10" style="text-align: center;font-weight: normal;color: #999;">暂无符合条件的数据记录</td></tr>';
			}
			$("#productTbody").html(html);
			initPageData(data["page_count"],data['data'].length,data['total_count']);
			$("#pageNumber").html(pagenumShow(jumpNumber,$("#page_count").val(),{$pageshow}));
			code();
		}
	});
}

//审核
function pass(status,id){
    var id = id;
    if(status==2){
        layer.prompt({title: '请输入预约失败原因', formType: 2,btnAlign: 'c'}, function(error_content, index){
            $.ajax({
                type: 'POST',
                url: "{:__URL('ADMIN_MAIN/services/statusSubscribe')}",
                data: { "id": id, "error_content": error_content,"status":status},
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    if (res.code == 1) {
                        $('.pass'+id).hide();
                        $('.status'+id).removeClass('label-info');
                        $('.status'+id).text('预约失败');
                        $('.status'+id).addClass('label-danger');
                        layer.msg(res.msg,{icon: 1});
                    } else {
                        layer.msg(res.msg,{icon: 2});
                    }
                }
            });
            layer.close(index);
        });
	}else{
        layer.confirm('确定通过预约？', {
            btnAlign: 'c',//按钮
			title:'提示'
        }, function(){
            $.ajax({
                type: 'POST',
                url: "{:__URL('ADMIN_MAIN/services/statusSubscribe')}",
                data: { "id": id, "status":status},
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    if (res.code == 1) {
                        $('.pass'+id).hide();
                        $('.status'+id).removeClass('label-info');
                        $('.status'+id).text('预约成功');
                        $('.status'+id).addClass('label-success');
                        layer.msg(res.msg,{icon: 1});
                    } else {
                        layer.msg(res.msg,{icon: 2});
                    }
                }
            });
            layer.closeAll();
        });
	}
}
//状态
function status(val){
    switch(val){
		case 0:
		    return '待处理';
		    break;
		case 1:
		    return '预约成功';
		    break;
		case 2:
		    return '预约失败';
		    break;
	}
}
//二维码
function code(){
	$(".div-flag-style").mouseover(function(){
		$(this).children('.QRcode').show();
	});
	$(".div-flag-style").mouseout(function(){
		$(this).children('.QRcode').hide();
	});
} 

//把值传过去即可
function updateGoodsDetail(goods_id) {
	window.location = __URL("ADMIN_MAIN/services/addgoods?step=2&goodsId="+ goods_id);
}

//全选
function CheckAll(event){
	var checked = event.checked;
	$("#productTbody input[type = 'checkbox']").prop("checked",checked);
}

//服务上架id合计
function goodsIdCount(line){
	var goods_ids= "";
	$("#productTbody input[type='checkbox']:checked").each(function() {
		if (!isNaN($(this).val())) {
			var state = $(this).data("state");
//			if(line == "online"){
//				if(state == 1){
//					$( "#dialog" ).dialog({
//						buttons: {
//							"确定": function() {
//								$(this).dialog('close');
//							}
//						},
//						contentText:"记录中包含已上架记录",
//						title:"消息提醒",
//					});
//					return false;
//				}
//			}else{
//				if(state == 0){
//					$( "#dialog" ).dialog({
//						buttons: {
//							"确定": function() {
//								$(this).dialog('close');
//							}
//						},
//						contentText:"记录中包含已下架记录",
//						title:"消息提醒",
//					});
//				return false;
//				}
//			}
			goods_ids = $(this).val() + "," + goods_ids;
		}
	});
	goods_ids = goods_ids.substring(0, goods_ids.length - 1);
	if(goods_ids == ""){
		$( "#dialog" ).dialog({
			buttons: {
				"确定": function() {
					$(this).dialog('close');
				}
			},
			contentText:"请选择需要操作的记录",
			title:"消息提醒",
		});
		return false;
	}
	modifyGoodsOnline(goods_ids,line);
}

//服务上下架
function modifyGoodsOnline(goods_ids,line){
	if(line == "online"){
		var url = "{:__URL('ADMIN_MAIN/services/modifygoodsonline')}";
		var lingStr = "上架";
	}else{
		var url = "{:__URL('ADMIN_MAIN/services/modifygoodsoffline')}";
		var lingStr = "下架";
	}
	$.ajax({
		type : "post",
		url : url,
		data : { "goods_ids" : goods_ids },
		success : function(data) {
			if(data["code"] > 0 ){
				LoadingInfo(getCurrentIndex(goods_ids,'#productTbody','tr[class="tr-title"]'));
				$("#dialog" ).dialog({
					buttons: {
						"确定": function() {
							$(this).dialog('close');
						}
					},
					contentText:"服务"+lingStr+"成功",
					title:"消息提醒",
					time:3
				});
			}
		}
	})
}

function batchDelete() {
	var goods_ids= new Array();
	$("#productTbody input[type='checkbox']:checked").each(function() {
		if (!isNaN($(this).val())) {
			goods_ids.push($(this).val());
		}
	});
	if(goods_ids.length ==0){
		$( "#dialog" ).dialog({
			buttons: {
				"确定,#e57373": function() {
					$(this).dialog('close');
				}
			},
			contentText:"请选择需要操作的记录",
			title:"消息提醒",
		});
		return false;
	}
	deleteGoods(goods_ids);
}

function deleteGoods(goods_ids){
	$( "#dialog" ).dialog({
		buttons: {
			"确定": function() {
				$.ajax({
					type : "post",
					url : "{:__URL('ADMIN_MAIN/services/deleteSubscribe')}",
					data : { "id" : goods_ids.toString() },
					dataType : "json",
					success : function(data) {
						if(data["code"] > 0 ){
							LoadingInfo(getCurrentIndex(goods_ids,'#productTbody','tr[class="tr-title"]'));
							$("#dialog").dialog({
								buttons: {
									"确定": function() {
										$(this).dialog('close');
									}
								},
								modal: true,
								contentText:data["message"],
								title:"消息提醒",
								time:1
							});
							$("#chek_all").prop("checked", false);
						}
					}
				});
				$(this).dialog('close');
			},
			"取消,#e57373": function() {
				$(this).dialog('close');
			},
		},
		contentText:"确定要删除吗？",
	});
}

//服务修改分组id合计
function goodsGroupIdCount(){
	var goods_ids= "";
	$("#productTbody input[type='checkbox']:checked").each(function() {
		if (!isNaN($(this).val())) {
			goods_ids = $(this).val() + "," + goods_ids;
		}
	});
	goods_ids = goods_ids.substring(0, goods_ids.length - 1);
	if(goods_ids == ""){
		$( "#dialog" ).dialog({
			buttons: {
				"确定": function() {
					$(this).dialog('close');
				}
			},
			contentText:"请选择需要操作的记录",
			title:"消息提醒",
		});
		return false;
	}
	$("#goods_type_ids").val(goods_ids);
	$("#editGroup").popover("show");
	$(".popover").css("max-width",'1000px');
}

//服务修改分组
function goodsGroupUpdate(){
	var goods_type = "";
	var goods_ids = $("#goods_type_ids").val();
	$("#goodsChecked input[type='checkbox']:checked").each(function(){
		if (!isNaN($(this).val())) {
			goods_type = $(this).val() + "," + goods_type;
		}
	})
	// if(goods_type == ""){
	// 	$( "#dialog" ).dialog({
	// 		buttons: {
	// 			"确定": function() {
	// 				$(this).dialog('close');
	// 			}
	// 		},
	// 		contentText:"请选择需要操作的记录",
	// 		title:"消息提醒",
	// 	});
	// 	return false;
	// }
	goods_type = goods_type.substring(0, goods_type.length - 1);
	$.ajax({
		type : "post",
		url : "{:__URL('ADMIN_MAIN/services/modifygoodsgroup')}",
		data : { "goods_id" : goods_ids, "goods_type" : goods_type },
		success : function(data) {
			if(data["code"] > 0 ){
				$("#editGroup").popover("hide");
				LoadingInfo(getCurrentIndex(goods_ids,'#productTbody','tr[class="tr-title"]'));
				$( "#dialog" ).dialog({
					buttons: {
						"确定": function() {
							$(this).dialog('close');
						}
					},
					contentText:data["message"],
					title:"消息提醒",
				});
			}
		}
	})
}

//显示 推荐选项
function ShowRecommend(){
	var goods_ids= "";
	$("#productTbody input[type='checkbox']:checked").each(function() {
		if (!isNaN($(this).val())) {
			goods_ids = $(this).val() + "," + goods_ids;
		}
	});
	goods_ids = goods_ids.substring(0, goods_ids.length - 1);
	if(goods_ids == ""){
		$( "#dialog" ).dialog({
			buttons: {
				"确定": function() {
					$(this).dialog('close');
				}
			},
			contentText:"请选择需要操作的记录",
			title:"消息提醒",
		});
		return false;
	}
	$("#goods_type_ids").val(goods_ids);
	$("#setRecommend").popover("show");
}

$("#recommendType label,#recommendType label input").live("click",function(){
	if($(this).children("input").is(":checked")){
		$(this).children("input").prop("checked",false);
	}else{
		$("#recommendType label input").prop("checked",false);
		$(this).children("input").prop("checked",true);
	}
})

//修改为  推荐 服务
function setRecommend(){
	var recommend_type = '';
	var goods_ids = $("#goods_type_ids").val();
	$("#recommendType input[type='checkbox']").each(function(){
		if ($(this).attr("checked") == 'checked') {
			var recommend_type_new = 1;
		}else{
			var recommend_type_new = 0;
		}
		recommend_type = recommend_type_new + "," + recommend_type;
	})
	if(recommend_type == ""){
		$( "#dialog" ).dialog({
			buttons: {
				"确定": function() {
					$(this).dialog('close');
				}
			},
			contentText:"请选择需要操作的记录",
			title:"消息提醒",
		});
		return false;
	}
	recommend_type = recommend_type.substring(0, recommend_type.length - 1);
	$.ajax({
		type : "post",
		url : "{:__URL('ADMIN_MAIN/services/modifygoodsrecommend')}",
		data : {
			"goods_id" : goods_ids,
			"recommend_type" : recommend_type
		},
		success : function(data) {
			if(data["code"] > 0 ){
				$("#setRecommend").popover("hide");
				LoadingInfo(getCurrentIndex(goods_ids,'#productTbody','tr[class="tr-title"]'));
				$( "#dialog" ).dialog({
					buttons: {
						"确定": function() {
							$(this).dialog('close');
						}
					},
					contentText:data["message"],
					title:"消息提醒",
				});
			} 
		}
	})
}

$("#goodsCategoryOne").click(function(){
	var isShow = $("#goodsCategoryOne").attr('is_show');
	if(isShow == "false"){
		$(".one").show();
		$(".selectGoodsCategory").css({
			'width' : 159,
			'right' : 580
		});
		$(".selectGoodsCategory").show();
		$("#goodsCategoryOne").attr('is_show','true');
		$(".js-mask-category").show();
	}else{
		$(".one").hide();
		$(".two").hide();
		$(".three").hide();
		$(".selectGoodsCategory").css({
			'width' : 159,
			'right' : 580
		});
		$(".selectGoodsCategory").hide();
		$("#goodsCategoryOne").attr('is_show','false');
	}
});

$(".js-mask-category").click(function(){
	$(".one").hide();
	$(".selectGoodsCategory").hide();
	$(".two").hide();
	$(".three").hide();
	$("#goodsCategoryOne").attr('is_show', 'false');
	$(this).hide();
});

$(".js-category-one").click(function(){
	parentId = $(this).attr("category_id");
	category_name = $(this).text();
	$(".one ul li").not($(this)).removeClass("selected");
	$(this).addClass("selected");
	$("#goodsCategoryOne").val($.trim(category_name)+">");
	$("#category_id_1").val(parentId);
	$("#category_id_2").val('');
	$("#category_id_3").val('');
	$.ajax({
		type : 'post',
		url : "{:__URL('ADMIN_MAIN/services/getcategorybyparentajax')}",
		data : {"parentId":parentId},
		success : function(data){
			if(data.length>0){
				var html = '';
				for (var i = 0; i < data.length; i++) {
					html += '<li class="js-category-two" category_id="'+data[i]['category_id']+'">'+data[i]['category_name'];
					if(data[i]['is_parent'] == 1){
						html += '<i class="fa fa-angle-right fa-lg"></i>';
					}
					html += '</li>';
				}
				$("#goodsCategoryTwo").html(html);
				$(".two").show();
				$(".selectGoodsCategory").css({
					'width' : 319,
					'right' : 361
				});
			}else{
				$(".one").hide();
				$(".two").hide();
				$(".js-mask-category").hide();
				$(".selectGoodsCategory").hide();
				$("#goodsCategoryOne").attr('is_show', 'false');
			}
			$(".three").hide();
		}
	});
	return false;
});

$(".js-category-two").live("click",function(event){
	var parentId = $(this).attr("category_id");
	var category_name = $(this).text();
	$(".two ul li").not($(this)).removeClass("selected");
	$(this).addClass("selected");
	var goodsCategoryOne = $("#goodsCategoryOne").val();
	$("#goodsCategoryOne").val(goodsCategoryOne+''+category_name+'>');
		$("#category_id_2").val(parentId);
	$("#category_id_3").val('');
	$.ajax({
		type : 'post',
		url : "{:__URL('ADMIN_MAIN/services/getcategorybyparentajax')}",
		data : {"parentId":parentId},
		success : function(data){
			if(data.length>0){
				var html = '';
				for (var i = 0; i < data.length; i++) {
					html += '<li onclick="goodsCategoryThree(this);" category_id="'+data[i]['category_id']+'">'+data[i]['category_name']+'<i class="fa fa-angle-right fa-lg"></i></li>';
				}
				$("#goodsCategoryThree").html(html);
				$(".three").show();
				$(".selectGoodsCategory").css({
					'width' : 480,
					'right' : 162
				});
			}else{
				$(".one").hide();
				$(".two").hide();
				$(".three").hide();
				$(".selectGoodsCategory").hide();
				$(".js-mask-category").hide();
				$("#goodsCategoryOne").attr('is_show', 'false');
			}
		}
	})
	event.stopPropagation();
});

function goodsCategoryThree(obj){
	var parentId = $(obj).attr("category_id");
	var category_name = $(obj).text();
	$(".three ul li").not($(obj)).removeClass("selected");
	$(obj).addClass("selected");
	var goodsCategoryOne = $("#goodsCategoryOne").val();
	$("#goodsCategoryOne").val(goodsCategoryOne+''+category_name);
		$("#category_id_3").val(parentId);
	$(".one").hide();
	$(".two").hide();
	$(".three").hide();
	$(".selectGoodsCategory").hide();
	$(".js-mask-category").hide();

	$(".selectGoodsCategory").css({
		'width' : 218,
		'right' : 580
	});
	$("#goodsCategoryOne").attr('is_show','false');
}

$("#confirmSelect").click(function(){
	$(".one").hide();
	$(".two").hide();
	$(".three").hide();
	$(".selectGoodsCategory").hide();
	$(".selectGoodsCategory").css({
		'width' : 218,
		'right' : 580
	});
})

function copyGoodsDetail(goods_id){
	$( "#dialog" ).dialog({
		buttons: {
			"确定": function() {
				$.ajax({
					type : "post",
					url : "{:__URL('ADMIN_MAIN/services/copygoods')}",
					data : {"goods_id":goods_id},
					dataType : "json",
					success : function(data) {
						if(data["code"] > 0 ){
							LoadingInfo(getCurrentIndex(goods_id,'#productTbody','tr[class="tr-title"]'));
							$("#dialog").dialog({
								buttons: {
									"确定": function() {
										$(this).dialog('close');
									}
								},
								modal: true,
								contentText:data["message"],
								title:"消息提醒",
								time:1
							});
							$("#chek_all").prop("checked", false);
						}
					}
				});
				$(this).dialog('close');
			},
			"取消,#e57373": function() {
				$(this).dialog('close');
			},
		},
		contentText:"确定要复制一条新的服务信息吗？",
	});
}

function changeSort(event){
	var sort = parseInt($(event).val());
	$(event).val(sort);
	var goods_id = $(event).attr("goods_id");
	$.ajax({
		type : "post",
		url : "{:__URL('ADMIN_MAIN/services/updateGoodsSortAjax')}",
		data : { "sort" : sort, "goods_id" : goods_id },
		success : function(data){
			if(data.code>0){
				LoadingInfo(getCurrentIndex(goods_id,'#productTbody','tr[class="tr-title"]'));
				showTip(data.message,"success");
			}else{
				showTip(data.message,"error");
			}
		}
	})
}

//更新二维码
function batchUpdateGoodsQrcode(){
	var goods_ids= new Array();
	$("#productTbody input[type='checkbox']:checked").each(function() {
		if (!isNaN($(this).val())) {
			goods_ids.push($(this).val());
		}
	});
	if(goods_ids.length == 0){
		showMessage("error", "请至少选择一件服务");
		return false;
	}
	$.ajax({
		type : "post",
		url : "{:__URL('ADMIN_MAIN/goods/updateGoodsQrcode')}",
		data : { "goods_id" : goods_ids.toString() },
		success : function(data){
			if (data["code"] > 0) {
				LoadingInfo(getCurrentIndex(goods_ids,'#productTbody','tr[class="tr-title"]'));
				showMessage('success', '二维码更新成功');
			}else{
				showMessage('error', data['message']);
			}
		}
	})
}

function selectGoodsLabel(){
	$("#selectGoodsLabel").popover("show");
	$("#selectGoodsLabelId").val('');
	$("#selectGoodsLabel").val('');
}

function hideGroup(){
	$("#selectGoodsLabel").popover("hide");
	$("#selectGoodsLabel").val('');
}

function clickGoodsLabel(event){
	var goods_label_id = $(event).val();
	var goods_label_name = $(event).next("span").text();
	var selectGoodsLabelVal = $("#selectGoodsLabel").val();
	var selectGoodsLabelId = $("#selectGoodsLabelId").val();
	if($(event).is(":checked")){
		$("#selectGoodsLabelId").val(selectGoodsLabelId+goods_label_id+',');
		$("#selectGoodsLabel").val(selectGoodsLabelVal+goods_label_name+';');
	}else{
		selectGoodsLabelVal = selectGoodsLabelVal.replace(goods_label_name+';','');
		selectGoodsLabelId = selectGoodsLabelId.replace(goods_label_id+',','');
		$("#selectGoodsLabelId").val(selectGoodsLabelId);
		$("#selectGoodsLabel").val(selectGoodsLabelVal);
	}
}

function confirm(){
	$("#selectGoodsLabel").popover("hide");
}

function editGoodsInfo(event){
	$(event).hide();
	$(event).next("input").show().focus();
}
// 点击显示更多搜索
$(".more_search").click(function(){
	$("#more_search").slideToggle();
})
</script>
{/block}