webpackJsonp([39,44],{200:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),i=n(o),s=a(5),r=n(s),m=a(7),c=n(m),l=a(12),d=a(13),g=a(4);t.default={components:{headTop:c.default},data:function(){return{title:"评价",host:"",imgurl:d.imgBaseUrl,info:{},type:"",score_list:[],contents:[],imgs:[],imgcheck:-1,anonymous:[]}},watch:{content:function(e){e.length>150&&(this.content=e.substring(0,150))}},beforeMount:function(){this.host=d.baseUrl,this.getInfo(),this.type&&"agent"!=this.type&&this.$router.go(-1)},methods:{upload:function(e){return!(this.imgs[e]&&this.imgs[e].length>=5)&&(this.imgcheck=e,void this.$refs.inputFile.click())},setField:function(e,t,a){this.$set(this[e],t,a)},setData:function(e){var t=this;for(var a in e)t.score_list[a]=5,t.contents[a]="",t.anonymous[a]=!1,t.imgs[a]=[];this.info=e},getInfo:function(){var e=this;return(0,r.default)(i.default.mark(function t(){var a;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.$vux.loading.show({text:"正在获取中......"}),t.next=3,(0,g.orderDetail)(e.$route.query.id);case 3:a=t.sent,e.$vux.loading.hide(),1==a.code?(1==a.data.order.is_evaluate?(e.type="agent",e.title="追加评价"):2==a.data.order.is_evaluate&&e.$router.go(-1),e.setData(a.data.order.order_goods)):(e.$vux.toast.text(a.msg,"middle"),setTimeout(function(){e.$router.go(-1)}));case 6:case"end":return t.stop()}},t,e)}))()},submit:function(){"agent"==this.type?this.agent():this.save()},agent:function(){var e=this;return(0,r.default)(i.default.mark(function t(){var a,n,o,s,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=[],n=e;for(o in e.info)s={order_id:n.info[o].order_id,order_goods_id:n.info[o].order_goods_id,imgs:n.imgs[o]+"",content:n.contents[o]?n.contents[o]:"此用户没有填写评价"},a.push(s);return e.$vux.loading.show({text:"正在提交..."}),e.$vux.loading.hide(),t.next=7,(0,g.addgoodsevaluateagain)(e.$route.query.id,a);case 7:r=t.sent,e.$vux.toast.text(r.msg,"middle"),1==r.code&&e.$router.go(-1);case 10:case"end":return t.stop()}},t,e)}))()},get_explain_type:function(e){return e>=4?1:e>=2?2:3},save:function(){var e=this;return(0,r.default)(i.default.mark(function t(){var a,n,o,s,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=[],n=e;for(o in e.info)s={is_anonymous:n.anonymous[o],order_id:n.info[o].order_id,order_goods_id:n.info[o].order_goods_id,scores:n.score_list[o],explain_type:n.get_explain_type(n.score_list[o]),imgs:n.imgs[o]+"",content:n.contents[o]?n.contents[o]:"此用户没有填写评价"},a.push(s);return e.$vux.loading.show({text:"正在提交..."}),t.next=6,(0,g.addgoodsevaluate)(e.$route.query.id,e.$route.query.order_no,a);case 6:r=t.sent,e.$vux.loading.hide(),e.$vux.toast.text(r.msg,"middle"),1==r.code&&e.$router.go(-1);case 10:case"end":return t.stop()}},t,e)}))()},del:function(e,t){var a=[],n=this;for(var o in this.imgs[e])o!=t&&a.push(n.imgs[e][o]);this.$set(this.imgs,e,a)},handkeFileChange:function(e){var t=this,a=document.getElementById("inputFile").files[0];if(!a)return!1;t.$vux.loading.show({text:"正在上传..."});var n=new FormData;n.append("file_path","upload/comment/"),n.append("file_upload",a);var o=new XMLHttpRequest;o.open("POST",this.host+"Uploade/uploadFile",!0),o.setRequestHeader("LS-Device-Type",(0,l.getStore)("device_type")),o.setRequestHeader("LS-Token",(0,l.getStore)("token")),o.onreadystatechange=function(){if(4===o.readyState){t.$vux.loading.hide();var e="";try{e=JSON.parse(o.responseText)}catch(t){e=o.responseText}if(1==e.code){var a=[];t.imgs[t.imgcheck]&&(a=t.imgs[t.imgcheck]),a.push(e.data),t.$set(t.imgs,t.imgcheck,a)}else t.$vux.toast.text(e.msg,"middle")}},o.send(n)},goto:function(e){this.$router.push(e)}}}},307:function(e,t,a){t=e.exports=a(2)(),t.push([e.id,"#comment .p-a-all[data-v-4405025f]{background:#eee;padding-bottom:.2rem}#comment .p-a-all .comment-box[data-v-4405025f]{margin-bottom:.2rem}#comment .p-a-all .rater i[data-v-4405025f]{color:#f44;margin:0 .1rem}#comment .p-a-all button[data-v-4405025f]{height:.8rem;font-size:.3rem;color:#666;margin-top:1rem;width:calc(100% - 2rem);color:#fff;background:#f44}#comment .p-a-all .goods[data-v-4405025f]{background:#fff;padding:.2rem .3rem;margin-bottom:2px}#comment .p-a-all .goods p[data-v-4405025f]{font-size:.28rem}#comment .p-a-all .goods img[data-v-4405025f]{width:1.5rem;height:1.5rem;background:#eee}#comment .p-a-all .goods div[data-v-4405025f]{width:calc(100% - 2rem);text-align:right}#comment .p-a-all .anonymous[data-v-4405025f]{padding:.2rem .3rem;margin:0;background:#fff}#comment .p-a-all .anonymous input[data-v-4405025f]{width:.3rem;height:.3rem}#comment .p-a-all textarea[data-v-4405025f]{width:100%;resize:none;color:#666;font-size:.26rem;padding:.2rem .3rem;margin:0}#comment .p-a-all .img-box[data-v-4405025f]{padding:.2rem .3rem;margin:0;background:#fff}#comment .p-a-all .img-box .list[data-v-4405025f]{font-size:0;margin-bottom:.2rem}#comment .p-a-all .img-box .list img[data-v-4405025f]{position:relative;width:1rem;height:1rem;background:#eee;display:inline-block;margin-right:.2rem}#comment .p-a-all .img-box .add-box[data-v-4405025f]{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}#comment .p-a-all .img-box .add-box i[data-v-4405025f]{width:1rem;height:1rem;border:1px solid #aaa;text-align:center;line-height:1rem;margin-right:.2rem;color:#666}","",{version:3,sources:["/./src/page/user/order/comment.vue"],names:[],mappings:"AACA,mCAAmC,gBAAgB,oBAAqB,CACvE,AACD,gDAAgD,mBAAoB,CACnE,AACD,4CAA4C,WAAc,cAAe,CACxE,AACD,0CAA0C,aAAc,gBAAiB,WAAW,gBAAgB,AAAgC,wBAAwB,WAAW,eAAkB,CACxL,AACD,0CAA0C,gBAAgB,oBAAsB,iBAAiB,CAChG,AACD,4CAA4C,gBAAiB,CAC5D,AACD,8CAA8C,aAAa,cAAc,eAAe,CACvF,AACD,8CAA8E,wBAAwB,gBAAgB,CACrH,AACD,8CAA8C,oBAAsB,SAAS,eAAe,CAC3F,AACD,oDAAoD,YAAa,YAAa,CAC7E,AACD,4CAA4C,WAAW,YAAY,WAAW,iBAAkB,oBAAsB,QAAQ,CAC7H,AACD,4CAA4C,oBAAsB,SAAS,eAAe,CACzF,AACD,kDAAkD,YAAY,mBAAoB,CACjF,AACD,sDAAsD,kBAAkB,WAAW,YAAY,gBAAgB,qBAAqB,kBAAmB,CACtJ,AACD,qDAA8F,oBAAoB,aAAa,AAAoD,sBAAsB,kBAAkB,CAC1N,AACD,uDAAuD,WAAW,YAAY,sBAAsB,kBAAkB,iBAAiB,mBAAoB,UAAU,CACpK",file:"comment.vue",sourcesContent:["\n#comment .p-a-all[data-v-4405025f]{background:#eee;padding-bottom:0.2rem\n}\n#comment .p-a-all .comment-box[data-v-4405025f]{margin-bottom:0.2rem\n}\n#comment .p-a-all .rater i[data-v-4405025f]{color:#ff4444;margin:0 0.1rem\n}\n#comment .p-a-all button[data-v-4405025f]{height:0.8rem;font-size:0.3rem;color:#666;margin-top:1rem;width:-webkit-calc(100% - 2rem);width:calc(100% - 2rem);color:#fff;background:#ff4444\n}\n#comment .p-a-all .goods[data-v-4405025f]{background:#fff;padding:0.2rem 0.3rem;margin-bottom:2px\n}\n#comment .p-a-all .goods p[data-v-4405025f]{font-size:0.28rem\n}\n#comment .p-a-all .goods img[data-v-4405025f]{width:1.5rem;height:1.5rem;background:#eee\n}\n#comment .p-a-all .goods div[data-v-4405025f]{width:-webkit-calc(100% - 2rem);width:calc(100% - 2rem);text-align:right\n}\n#comment .p-a-all .anonymous[data-v-4405025f]{padding:0.2rem 0.3rem;margin:0;background:#fff\n}\n#comment .p-a-all .anonymous input[data-v-4405025f]{width:0.3rem;height:0.3rem\n}\n#comment .p-a-all textarea[data-v-4405025f]{width:100%;resize:none;color:#666;font-size:0.26rem;padding:0.2rem 0.3rem;margin:0\n}\n#comment .p-a-all .img-box[data-v-4405025f]{padding:0.2rem 0.3rem;margin:0;background:#fff\n}\n#comment .p-a-all .img-box .list[data-v-4405025f]{font-size:0;margin-bottom:0.2rem\n}\n#comment .p-a-all .img-box .list img[data-v-4405025f]{position:relative;width:1rem;height:1rem;background:#eee;display:inline-block;margin-right:0.2rem\n}\n#comment .p-a-all .img-box .add-box[data-v-4405025f]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center\n}\n#comment .p-a-all .img-box .add-box i[data-v-4405025f]{width:1rem;height:1rem;border:1px solid #aaa;text-align:center;line-height:1rem;margin-right:0.2rem;color:#666\n}\n"],sourceRoot:"webpack://"}])},397:function(e,t,a){var n=a(307);"string"==typeof n&&(n=[[e.id,n,""]]);a(3)(n,{});n.locals&&(e.exports=n.locals)},540:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"comment"}},[a("head-top",{attrs:{"go-back":!0,"head-title":e.title,rightMenu:!0}}),e._v(" "),a("div",{staticClass:"p-a-all"},[e._l(e.info,function(t,n){return a("div",{key:n,staticClass:"comment-box"},[a("div",{staticClass:"goods flex-box",on:{click:function(a){e.goto("/goods?id="+t.goods_id)}}},[a("img",{attrs:{src:t.picture_info.pic_cover_small,alt:""}}),e._v(" "),a("div",[a("p",{staticClass:"ellipsis"},[e._v(e._s(t.goods_name))]),e._v(" "),a("p",{staticClass:"font-size-12 text-color-999"},[e._v(e._s(t.sku_name))]),e._v(" "),a("p",{staticClass:"price"},[e._v("￥"+e._s(t.price))]),e._v(" "),a("p",{staticClass:"font-size-12 text-color-999"},[e._v("x"+e._s(t.num))])])]),e._v(" "),a("div",{staticClass:"flex"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.contents[n],expression:"contents[key]"}],attrs:{rows:"5",placeholder:"请输入要评价的内容，不要超过150个字符。。"},domProps:{value:e.contents[n]},on:{input:function(t){t.target.composing||e.$set(e.contents,n,t.target.value)}}})]),e._v(" "),a("div",{staticClass:"img-box"},[a("div",{staticClass:"list"},e._l(e.imgs[n],function(t,o){return a("img",{key:o,attrs:{src:e.imgurl+t},on:{click:function(t){e.del(n,o)}}})})),e._v(" "),a("div",{staticClass:"add-box"},[a("i",{staticClass:"iconfont icon-camera needsclick",on:{click:function(t){e.upload(n)}}}),e._v("\n          发照片 "+e._s(e.imgs[n]?e.imgs[n].length:0)+"/5\n          "),a("span",{staticClass:"font-size-12 text-color-999"},[e._v("(点击图片删除)")])])]),e._v(" "),e.type?e._e():a("div",[a("div",{staticClass:"flex-box",staticStyle:{padding:"0.2rem 0.3rem",background:"#fff"}},[a("span",[e._v("商品与描述相符")]),e._v(" "),e.score_list[n]?a("div",{staticClass:"rater"},e._l(5,function(t){return a("i",{key:t,staticClass:"iconfont ",class:{"icon-ziyuan":t<=e.score_list[n],"icon-xingxing-copy":t>e.score_list[n]},on:{click:function(a){e.setField("score_list",n,t)}}})})):e._e()]),e._v(" "),a("div",{staticClass:"flex-box anonymous",on:{click:function(t){e.setField("anonymous",n,!e.anonymous[n])}}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.anonymous[n],expression:"anonymous[key]"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.anonymous[n])?e._i(e.anonymous[n],null)>-1:e.anonymous[n]},on:{change:function(t){var a=e.anonymous[n],o=t.target,i=!!o.checked;if(Array.isArray(a)){var s=null,r=e._i(a,s);o.checked?r<0&&e.$set(e.anonymous,n,a.concat([s])):r>-1&&e.$set(e.anonymous,n,a.slice(0,r).concat(a.slice(r+1)))}else e.$set(e.anonymous,n,i)}}}),e._v(" "),a("span",[e._v("匿名评价")])])])])}),e._v(" "),a("input",{ref:"inputFile",staticStyle:{opacity:"0"},attrs:{type:"file",id:"inputFile",capture:"camera",accept:"image/*"},on:{change:e.handkeFileChange}}),e._v(" "),a("div",{staticClass:"text-align-center"},[a("button",{on:{click:e.submit}},[e._v("提交")])])],2)],1)},staticRenderFns:[]}},670:function(e,t,a){a(397);var n=a(1)(a(200),a(540),"data-v-4405025f",null);e.exports=n.exports}});